<!doctype html><html><head lang=en><meta charset=utf-8><meta http-equiv=X-UA-Compatible content="IE=edge"><title>std::unordered_map: emplace vs try_emplace - inline</title><meta name=viewport content="width=device-width,initial-scale=1"><meta name=description content="Comparing insertion methods in std::unordered_map"><meta property="og:image" content><meta property="og:url" content="https://valkyrja-design.github.io/inline/posts/emplace_vs_try_emplace/"><meta property="og:site_name" content="inline"><meta property="og:title" content="std::unordered_map: emplace vs try_emplace"><meta property="og:description" content="Comparing insertion methods in std::unordered_map"><meta property="og:locale" content="en_us"><meta property="og:type" content="article"><meta property="article:section" content="posts"><meta property="article:published_time" content="2025-12-27T19:42:03+05:30"><meta property="article:modified_time" content="2025-12-27T19:42:03+05:30"><meta property="article:tag" content="C++"><meta property="article:tag" content="STL"><meta property="article:tag" content="Unordered_map"><meta property="article:tag" content="Emplace"><meta property="article:tag" content="Try_emplace"><meta name=twitter:card content="summary"><meta name=twitter:title content="std::unordered_map: emplace vs try_emplace"><meta name=twitter:description content="Comparing insertion methods in std::unordered_map"><link href=https://valkyrja-design.github.io/inline/css/fonts.2c2227b81b1970a03e760aa2e6121cd01f87c88586803cbb282aa224720a765f.css rel=stylesheet><link rel=stylesheet type=text/css media=screen href=https://valkyrja-design.github.io/inline/css/main.7a5c05040394322612a2d98397e9932aa81d9d7acc70199463e79f8180c8e0c0.css><link id=darkModeStyle rel=stylesheet type=text/css href=https://valkyrja-design.github.io/inline/css/dark.478e7f2b9cf8d87be42edfd9fe1810beab1331847df94b1b430478b309f28282.css disabled></head><body><div class=content><header><div class=main><a href=https://valkyrja-design.github.io/inline/>inline</a></div><nav><a href=/inline/>Home</a>
<a href=/inline/posts>All posts</a>
<a href=/inline/tags>Tags</a>
<button id=dark-mode-toggle class=nav-toggle onclick=toggleTheme() aria-label="Toggle dark mode" type=button><svg class="feather" viewBox="0 0 24 24" fill="none" stroke="#232333" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="5"/><line x1="12" y1="1" x2="12" y2="3"/><line x1="12" y1="21" x2="12" y2="23"/><line x1="4.22" y1="4.22" x2="5.64" y2="5.64"/><line x1="18.36" y1="18.36" x2="19.78" y2="19.78"/><line x1="1" y1="12" x2="3" y2="12"/><line x1="21" y1="12" x2="23" y2="12"/><line x1="4.22" y1="19.78" x2="5.64" y2="18.36"/><line x1="18.36" y1="5.64" x2="19.78" y2="4.22"/></svg></button>
<script src=https://valkyrja-design.github.io/inline/js/themetoggle.js></script></nav></header><main><article><div class=post-container><div class=post-content><div class=title><h1 class=title>std::unordered_map: emplace vs try_emplace</h1><div class=meta>Posted on Dec 27, 2025</div></div><section class=body><p><code>std::unordered_map</code> provides 3 primary methods for inserting elements with each differing in how
the key and value type are constructed and inserted. <code>insert</code> is mostly the same as <code>emplace</code> except
when called with an object of the map&rsquo;s value type directly.</p><h2 id=emplace><a href=https://en.cppreference.com/w/cpp/container/unordered_map/emplace.html><code>emplace</code></a></h2><p><code>emplace</code> constructs the key and value in place using the provided arguments. This means that
even if the key is immovable and non-copyable <code>emplace</code> still works. The downside of emplace is that
the value object is always constructed even if the key already exists in the map.</p><h2 id=try_emplace><a href=https://en.cppreference.com/w/cpp/container/unordered_map/try_emplace.html><code>try_emplace</code></a></h2><p><code>try_emplace</code> constructs the value only if the key does not already exist in the map. The downside
of <code>try_emplace</code> is that the key must be copyable or movable, as it cannot construct the key
in-place like emplace can with <code>std::piecewise_construct</code>. Now <code>try_emplace</code> also uses piecewise
construction, but the subtle difference is in the arguments used for the construction.</p><p><a href=https://godbolt.org/z/dsMa99bKG>See demo on Godbolt</a></p><div class=highlight><pre tabindex=0 style=color:#e6edf3;background-color:#0d1117;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-c++ data-lang=c++><span style=display:flex><span><span style=color:#8b949e;font-weight:700;font-style:italic>#include</span> <span style=color:#8b949e;font-weight:700;font-style:italic>&lt;iostream&gt;</span><span style=color:#8b949e;font-weight:700;font-style:italic>
</span></span></span><span style=display:flex><span><span style=color:#8b949e;font-weight:700;font-style:italic>#include</span> <span style=color:#8b949e;font-weight:700;font-style:italic>&lt;unordered_map&gt;</span><span style=color:#8b949e;font-weight:700;font-style:italic>
</span></span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#ff7b72>struct</span> <span style=color:#f0883e;font-weight:700>A</span> {
</span></span><span style=display:flex><span>    A(<span style=color:#ff7b72>int</span> x) <span style=color:#ff7b72;font-weight:700>:</span> x{x} { std<span style=color:#ff7b72;font-weight:700>::</span>cout <span style=color:#ff7b72;font-weight:700>&lt;&lt;</span> <span style=color:#a5d6ff>&#34;A ctor</span><span style=color:#79c0ff>\n</span><span style=color:#a5d6ff>&#34;</span>; }
</span></span><span style=display:flex><span>    A(<span style=color:#ff7b72>const</span> A<span style=color:#ff7b72;font-weight:700>&amp;</span>) { std<span style=color:#ff7b72;font-weight:700>::</span>cout <span style=color:#ff7b72;font-weight:700>&lt;&lt;</span> <span style=color:#a5d6ff>&#34;A copy ctor</span><span style=color:#79c0ff>\n</span><span style=color:#a5d6ff>&#34;</span>; }
</span></span><span style=display:flex><span>    A(A<span style=color:#ff7b72;font-weight:700>&amp;&amp;</span>) { std<span style=color:#ff7b72;font-weight:700>::</span>cout <span style=color:#ff7b72;font-weight:700>&lt;&lt;</span> <span style=color:#a5d6ff>&#34;A move ctor</span><span style=color:#79c0ff>\n</span><span style=color:#a5d6ff>&#34;</span>; }
</span></span><span style=display:flex><span>    <span style=color:#ff7b72>bool</span> <span style=color:#ff7b72>operator</span><span style=color:#ff7b72;font-weight:700>==</span>(<span style=color:#ff7b72>const</span> A<span style=color:#ff7b72;font-weight:700>&amp;</span> other) <span style=color:#ff7b72>const</span> { <span style=color:#ff7b72>return</span> x <span style=color:#ff7b72;font-weight:700>==</span> other.x; }
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#ff7b72>int</span> x;
</span></span><span style=display:flex><span>};
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#ff7b72>struct</span> <span style=color:#f0883e;font-weight:700>B</span> {
</span></span><span style=display:flex><span>    B(<span style=color:#ff7b72>int</span> x) <span style=color:#ff7b72;font-weight:700>:</span> x{x} { std<span style=color:#ff7b72;font-weight:700>::</span>cout <span style=color:#ff7b72;font-weight:700>&lt;&lt;</span> <span style=color:#a5d6ff>&#34;B ctor</span><span style=color:#79c0ff>\n</span><span style=color:#a5d6ff>&#34;</span>; }
</span></span><span style=display:flex><span>    B(<span style=color:#ff7b72>const</span> B<span style=color:#ff7b72;font-weight:700>&amp;</span>) { std<span style=color:#ff7b72;font-weight:700>::</span>cout <span style=color:#ff7b72;font-weight:700>&lt;&lt;</span> <span style=color:#a5d6ff>&#34;B copy ctor</span><span style=color:#79c0ff>\n</span><span style=color:#a5d6ff>&#34;</span>; }
</span></span><span style=display:flex><span>    B(B<span style=color:#ff7b72;font-weight:700>&amp;&amp;</span>) { std<span style=color:#ff7b72;font-weight:700>::</span>cout <span style=color:#ff7b72;font-weight:700>&lt;&lt;</span> <span style=color:#a5d6ff>&#34;B move ctor</span><span style=color:#79c0ff>\n</span><span style=color:#a5d6ff>&#34;</span>; }
</span></span><span style=display:flex><span>    <span style=color:#ff7b72>int</span> x;
</span></span><span style=display:flex><span>};
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#ff7b72>template</span> <span style=color:#ff7b72;font-weight:700>&lt;&gt;</span>
</span></span><span style=display:flex><span><span style=color:#ff7b72>struct</span> <span style=color:#f0883e;font-weight:700>std</span><span style=color:#ff7b72;font-weight:700>::</span>hash<span style=color:#ff7b72;font-weight:700>&lt;</span>A<span style=color:#ff7b72;font-weight:700>&gt;</span> {
</span></span><span style=display:flex><span>    std<span style=color:#ff7b72;font-weight:700>::</span>size_t <span style=color:#ff7b72>operator</span>()(<span style=color:#ff7b72>const</span> A<span style=color:#ff7b72;font-weight:700>&amp;</span> a) <span style=color:#ff7b72>const</span> <span style=color:#ff7b72>noexcept</span> {
</span></span><span style=display:flex><span>        <span style=color:#ff7b72>return</span> std<span style=color:#ff7b72;font-weight:700>::</span>hash<span style=color:#ff7b72;font-weight:700>&lt;</span><span style=color:#ff7b72>int</span><span style=color:#ff7b72;font-weight:700>&gt;</span>{}(a.x);
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>};
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#ff7b72>int</span> <span style=color:#d2a8ff;font-weight:700>main</span>() {
</span></span><span style=display:flex><span>    std<span style=color:#ff7b72;font-weight:700>::</span>unordered_map<span style=color:#ff7b72;font-weight:700>&lt;</span>A, B<span style=color:#ff7b72;font-weight:700>&gt;</span> mp;
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#8b949e;font-style:italic>// This does moves
</span></span></span><span style=display:flex><span>    std<span style=color:#ff7b72;font-weight:700>::</span>cout <span style=color:#ff7b72;font-weight:700>&lt;&lt;</span> <span style=color:#a5d6ff>&#34;emplace with key object:</span><span style=color:#79c0ff>\n</span><span style=color:#a5d6ff>&#34;</span>;
</span></span><span style=display:flex><span>    mp.emplace(A{<span style=color:#a5d6ff>1</span>}, B{<span style=color:#a5d6ff>1</span>});
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    std<span style=color:#ff7b72;font-weight:700>::</span>cout <span style=color:#ff7b72;font-weight:700>&lt;&lt;</span> <span style=color:#a5d6ff>&#34;emplace with constructor arguments:</span><span style=color:#79c0ff>\n</span><span style=color:#a5d6ff>&#34;</span>;
</span></span><span style=display:flex><span>    <span style=color:#8b949e;font-style:italic>// But this constructs everything in-place
</span></span></span><span style=display:flex><span>    mp.emplace(<span style=color:#a5d6ff>2</span>, <span style=color:#a5d6ff>2</span>);
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    std<span style=color:#ff7b72;font-weight:700>::</span>cout <span style=color:#ff7b72;font-weight:700>&lt;&lt;</span> <span style=color:#a5d6ff>&#34;try_emplace:</span><span style=color:#79c0ff>\n</span><span style=color:#a5d6ff>&#34;</span>;
</span></span><span style=display:flex><span>    <span style=color:#8b949e;font-style:italic>// try_emplace takes the key directly as argument (not the parameters needed
</span></span></span><span style=display:flex><span>    <span style=color:#8b949e;font-style:italic>// to call the key type&#39;s constructor). So it has to perform a move/copy if
</span></span></span><span style=display:flex><span>    <span style=color:#8b949e;font-style:italic>// insertion happens. Note that the corresponding value is still constructed
</span></span></span><span style=display:flex><span>    <span style=color:#8b949e;font-style:italic>// in-place
</span></span></span><span style=display:flex><span>    mp.try_emplace(A{<span style=color:#a5d6ff>1</span>}, <span style=color:#a5d6ff>3</span>);
</span></span><span style=display:flex><span>}
</span></span></code></pre></div><hr><h2 id=references>References</h2><ul><li><a href=https://stackoverflow.com/questions/27960325/stdmap-emplace-without-copying-value/27960637#27960637>StackOverflow: std::map emplace without copying value</a></li><li><a href=https://stackoverflow.com/questions/46046828/is-there-any-reason-to-use-stdmapemplace-instead-of-try-emplace-in-c17>StackOverflow: Is there any reason to use emplace over try_emplace in C++17?</a></li></ul></section><div class=post-tags><nav class="nav tags"><ul class=tags><li><a href=/tags/c++>C++</a></li><li><a href=/tags/stl>STL</a></li><li><a href=/tags/unordered_map>unordered_map</a></li><li><a href=/tags/emplace>emplace</a></li><li><a href=/tags/try_emplace>try_emplace</a></li></ul></nav></div></div></div></article></main><footer><div style=display:flex><a class=soc href=https://github.com/Valkyrja-Design rel=me title=GitHub><svg class="feather"><use href="/inline/svg/feather-sprite.51cf5647cb1987f769b616558f2620fd9423d72058490231b391bf6aa3744b55.svg#github"/></svg></a><a class=border></a></div><div class=footer-info>2026 <a href=https://github.com/athul/archie>Archie Theme</a> | Built with <a href=https://gohugo.io>Hugo</a></div></footer></div></body></html>